<!DOCTYPE html><head><title>krpano Protect Tool</title><link rel="stylesheet" href="../design/style.css"><link rel="stylesheet" href="../design/gui_listbox.css"><style>html{height:100%}body{height:100%;margin:0;padding:0}</style></head><body><div id="protectframe" style="position:absolute;width:100%;height:100%;display:table" xonselectstart="return false;"><div style="display:table-row" class="gui_statictext"><div style="color:#336699;margin:10px"><b>Protect</b> - Create custom krpano viewer files with special access / content protection settings.</div></div><div style="display:table-row"><table style="font-size:inherit;margin:0;padding:0 10px;width:100%" cellspacing="0"><tr><td style="margin:0;padding:0;vertical-align:top; white-space:nowrap"><span class="gui_statictext">Output:</span><br><input id="m_html5" type="checkbox" onclick="update_html5_fields()"><label for="m_html5">HTML5 (.js)</label><br><input id="m_flash" type="checkbox" onclick="update_flash_fields()"><label for="m_flash">FLASH (.swf)</label><span id="m_embedfiles_info" style="vertical-align:middle;margin-left:20px"><a id="m_embedfiles_link" href="#" tabindex="-1" onclick="on_embed_files()">Embed files</a> <span id="m_embedfiles_totalinfo" style="margin-left:3px" class="gui_statictext">(0 Files, 0 kB)</span></span> </td></tr></table></div><div style="display:table-row"><hr style="margin:10px"><table style="font-size:inherit;margin:0 10px;padding:0" cellspacing="0"><tr><td style="margin:0;padding:0;vertical-align:top"><input id="m_pxml" type="checkbox"><label for="m_pxml" id="m_pxml_label">Allow loading only privately encrypted xml and plugin files.</label><br><input id="m_noex" type="checkbox"><label for="m_noex">Allow loading only xml and plugin files from the same domain.</label><br><input id="m_noee" type="checkbox"><label for="m_noee">Block viewer embedding into external (cross-domain) iframes.</label><br><input id="m_nolu" type="checkbox"><label for="m_nolu">Disable the local / offline usage.</label><br><input id="m_noep" type="checkbox"><label for="m_noep">Disable the passing of external parameters.</label><br><input id="m_nojs" type="checkbox"><label for="m_nojs">Disable the Javascript interface.</label><br><table style="width:100%;font-size:inherit;margin:0;padding:0" cellspacing="0"><tr><td style="margin:0;padding:0;vertical-align:top"><input id="m_bf" type="checkbox"><label id="m_bf_label" for="m_bf">Branding Free</label></td><td style="margin:0;padding:0;vertical-align:top;text-align:right"><span id="m_bf_link" style="vertical-align:middle"><a href="#" tabindex="-1" onclick="buybflink()" ondragstart="return false">Buy License</a></span></td></tr></table></td><td style="margin:0;padding:0;vertical-align:top;padding-left:28px;color:#336699"></td></tr></table><hr style="margin:10px"><div style="margin:10px"><input id="m_expiredate" type="checkbox" onclick="update_expiredate_fields()"><label for="m_expiredate">Set expire date:</label><input id="m_ed_date" style="vertical-align:middle;margin-left:4px" type="date"><br><span id="m_ed_txt1" style="vertical-align:middle;padding-left:4px">Website to open when expired:</span><input id="m_ed_url" style="vertical-align:middle;margin-left:4px;width:50%" type="url" value="http://krpano.com/expired/"></div><hr style="margin:10px"><div style="margin:10px 10px 2px 10px"><input id="m_limitdomains" type="checkbox" onclick="update_limitdomain_fields()"><label for="m_limitdomains">Limit Domains</label><br></div></div><div style="display:table-row;height:100%"><table style="font-size:inherit;padding:0;margin:0 10px;height:100%;padding-left:4px" cellspacing="0"><tr><td style="margin:0;padding:0;vertical-align:top"><div id="m_domainlist" style="padding:0; margin:0; width:300px;height:100%"></div></td><td style="margin:0;padding:0;vertical-align:top;padding-left:6px"><input id="m_adddomain" style="margin-top:0;width:100%" type="button" value="Add Domain" onclick="on_add_domain()"><br><input id="m_editdomain" style="width:100%" type="button" value="Edit Domain" onclick="on_edit_domain()"><br><input id="m_removedomain" style="width:100%" type="button" value="Remove" onclick="on_remove_domain()"><br></td></tr></table></div><div style="display:table-row"><div style="margin:10px 0 10px 10px"><button id="m_generate_viewers" onclick="on_generate_viewers()">Generate Viewers</button> <button id="m_openoutputfolder" disabled="disabled" onclick="on_open_output_folder()">Open Output Folder</button></div></div></div></body><script>function embeddedfile(){this.filepath=null,this.filepath_rel=null,this.type=null,this.size=0,this.embed=!0}function swfembed(){this.embeddedfile=embeddedfile,this.startupxml=null,this.basepath=null,this.totalinfo=null,this.opt_autosort=!0,this.opt_startupxml=!0,this.opt_encryptall=!1,this.ui_last_add_folder=null,this.files=[]}function ID(e){return document.getElementById(e)}function settings_to_dom(e){ui_last_output_folder=e?e.ui_last_output_folder:null,m_embeddedfiles=e&&e.swfembed?e.swfembed:new swfembed,m_embeddedfiles.embeddedfile=embeddedfile,ID("m_flash").checked=e?e.m_flash:!0,ID("m_html5").checked=e?e.m_html5:!0,ID("m_embedfiles_totalinfo").innerHTML="("+(m_embeddedfiles.totalinfo?m_embeddedfiles.totalinfo:"0 Files - 0 Byte")+")",ID("m_pxml").checked=e?e.m_pxml:!1,ID("m_noex").checked=e?e.m_noex:!1,ID("m_noee").checked=e?e.m_noee:!1,ID("m_nolu").checked=e?e.m_nolu:!1,ID("m_noep").checked=e?e.m_noep:!1,ID("m_nojs").checked=e?e.m_nojs:!1,ID("m_bf").checked=e?e.m_bf:!1;var t=new Date,n=t.getDate(),r=t.getMonth()+1,i=t.getFullYear()+1,s=""+i+"-"+(r<=9?"0"+r:r)+"-"+(n<=9?"0"+n:n);ID("m_expiredate").checked=e?e.m_expiredate:!1,ID("m_ed_date").value=e&&e.m_expiredate?e.m_ed_date:s,ID("m_ed_url").value=e?e.m_ed_url:"http://krpano.com/expired/",ID("m_limitdomains").checked=e?e.m_limitdomains:!1;var o=ID("m_domainlist"),u=e?e.m_domainlist:[],a;for(a=0;a<u.length;a++){var f=document.createElement("option");f.text=u[a],o.add(f)}}function settings_from_dom(){var e={};e.ui_last_output_folder=ui_last_output_folder,e.m_flash=ID("m_flash").checked,e.m_html5=ID("m_html5").checked,e.m_embedjs=!0,e.m_pxml=ID("m_pxml").checked,e.m_noex=ID("m_noex").checked,e.m_noee=ID("m_noee").checked,e.m_nolu=ID("m_nolu").checked,e.m_noep=ID("m_noep").checked,e.m_nojs=ID("m_nojs").checked,e.m_bf=ID("m_bf").checked,e.m_expiredate=ID("m_expiredate").checked,e.m_ed_date=ID("m_ed_date").value,e.m_ed_url=ID("m_ed_url").value,e.m_limitdomains=ID("m_limitdomains").checked;var t=ID("m_domainlist"),n=[],r;for(r=0;r<t.options.length;r++)n.push(t.options[r].text);return e.m_domainlist=n,e}function savesettings(){if(localStorage){var e=settings_from_dom();delete m_embeddedfiles.embeddedfile,e.swfembed=m_embeddedfiles,localStorage.protect=JSON.stringify(e),m_embeddedfiles.embeddedfile=embeddedfile}}function gui_iframe_close_callback(){}function on_add_preset(){}function on_remove_preset(){}function update_flash_fields(){var e=ID("m_flash").checked;ID("m_embedfiles_info").style.pointerEvents=e?"":"none",ID("m_embedfiles_info").style.opacity=e?1:.5,ID("m_embedfiles_link").style.color=e?"":"black"}function update_html5_fields(){}function update_expiredate_fields(){var e=ID("m_expiredate").checked;ID("m_ed_date").disabled=!e,ID("m_ed_txt1").style.opacity=e?1:.5,ID("m_ed_url").disabled=!e}function update_limitdomain_fields(){var e=ID("m_limitdomains").checked;ID("m_domainlist").disabled=!e,ID("m_adddomain").disabled=!e,ID("m_editdomain").disabled=!e,ID("m_removedomain").disabled=!e}function fix_domain(e){e=(""+e).toLowerCase();var t=e.indexOf("://");return t>0&&(e=e.slice(t+3)),e.slice(0,4)=="www."&&(e=e.slice(4)),t=e.indexOf("/"),t>0&&(e=e.slice(0,t)),t=e.indexOf(":"),t>0&&(e=e.slice(0,t)),e=e.split(";").join("").split("#").join("").split("\\").join(""),e}function on_add_domain(){top.krpanoui.promptDialog({title:"Add Domain",infotext:"Enter domain name: <span style='padding-left:8px;'>(use * as wildcard character)</span>",value:"",onclose:function(e){e&&(e=(""+e).trim());var t=e;if(t){var n=ID("m_domainlist");t=fix_domain(t);var r=!0,i=[],s=n.options.length,o;for(o=0;o<s;o++){var u=n.options[o].text;if(u==t){r=!1;break}i.push(u)}if(r){i.push(t),i.sort(),domainlist_listbox.removeAll(),s=i.length;for(o=0;o<s;o++)domainlist_listbox.addTextRow([i[o]])}}}})}function on_edit_domain(){var e=ID("m_domainlist"),t=e.selectedIndex;if(t>=0){var n=e.options[t].text;top.krpanoui.promptDialog({title:"Edit Domain",infotext:"Enter domain name: <span style='padding-left:8px;'>(use * as wildcard character)</span>",value:n,onclose:function(r){r&&(n=(""+r).trim()),n&&(n=fix_domain(n),e.listbox.setCellText(t,0,n))}})}}function on_remove_domain(){var e=ID("m_domainlist"),t;for(t=e.options.length-1;t>=0;t--)e.options[t].selected&&e.remove(t)}function buybflink(e){var t=top.nwrequire("nw.gui");t.Shell.openExternal("http://krpano.com/buy/brandingfree/#top")}function update_license_info(){var e=top.reginfo.lz,t=top.reginfo.tags,n=(e&4)==4,r=ID("m_pxml"),i=ID("m_pxml_label"),s=ID("m_bf"),o=ID("m_bf_label"),u=ID("m_bf_link");(e&1)==0?(r.checked=!1,r.disabled=!0,i.style.opacity=.5):(r.disabled=!1,i.style.opacity=1),n==0?(s.checked=!1,s.disabled=!0,o.style.opacity=.5,u.style.display=""):(s.disabled=!1,o.style.opacity=1,u.style.display="none")}function on_embed_files(){var e=top.innerWidth*.8|0,t=top.innerHeight*.8|0;e<640&&(e=640),e>1e3&&(e=1e3),t<480&&(t=480),top.gui_modal_window("frames/protect_embedfiles.html",{width:e,height:t,resizeable:!0,args:m_embeddedfiles,onclosed:on_embed_files_done})}function on_embed_files_done(e){m_embeddedfiles=e,ID("m_embedfiles_totalinfo").innerHTML="("+(m_embeddedfiles.totalinfo?m_embeddedfiles.totalinfo:"0 Files - 0 Byte")+")"}function on_open_output_folder(){var e=top.nwrequire("nw.gui"),t=top.nwrequire("fs");ui_last_output_folder_filename&&t.existsSync(ui_last_output_folder_filename)?e.Shell.showItemInFolder(ui_last_output_folder_filename):e.Shell.openItem(ui_last_output_folder)}function on_generate_viewers(){function n(t,n,r,i,s){var o="";return t&&(t=e.basename(t),o+=t+" - "+n+"<br>"),r&&(r=e.basename(r),o+=r+" - "+i+"<br>"),o+="<br><progress style='width:100%;'"+(s?"":" value='1' max='1' ")+"></progress>",o}function r(r){if(!r)return;var s=e.dirname(r),o=e.basename(r,e.extname(e.basename(r))),u=null,a=null;t.m_flash&&(u=s+e.sep+o+".swf"),t.m_html5&&(a=s+e.sep+o+".js"),ui_last_output_folder_filename=r,ui_last_output_folder=s;var f={swf:"processing...",js:"processing..."};top.krpanoui.simpleDialog({title:"Generating files...",content:n(u,f.swf,a,f.js,!0),buttonmode:0,height:200,locked:!0,onready:function(e){e.setFocusButton(0),i(u,a,f,e)},onclose:null})}function i(e,r,i,s){function f(e,t){e=="OK"?i.swf="done.":i.swf="<span style='color:red;'>"+e+"</span>",c(e)}function l(e,t){e=="OK"?i.js="done.":i.js="<span style='color:red;'>"+e+"</span>",c(e)}function c(t,o){a--,s.setContent(n(e,i.swf,r,i.js,a>0)),a<=0&&(s.setTitle("Done."),s.setLocked(!1),a=0)}var o=[];t.m_pxml&&(o.push("-pxml"),o.push("-pplg")),t.m_noex&&o.push("-noex"),t.m_noee&&o.push("-noee"),t.m_nolu&&o.push("-nolu"),t.m_noep&&o.push("-noep"),t.m_nojs&&o.push("-nojs"),t.m_bf&&o.push("-bf"),t.m_expiredate&&t.m_ed_date&&(o.push("-expire="+t.m_ed_date),t.m_ed_url&&o.push(top.krpanotools.encodeParam("-expiredurl="+t.m_ed_url)));if(t.m_limitdomains){var u;for(u=0;u<t.m_domainlist.length;u++)o.push(top.krpanotools.encodeParam("-domain="+t.m_domainlist[u]))}o.push("-nomb");var a=0;if(t.m_flash){var h=[].concat(o);h.push(top.krpanotools.encodeParam("-o="+e));if(m_embeddedfiles&&m_embeddedfiles.files&&m_embeddedfiles.files.length>0){var p=m_embeddedfiles.startupxml;p&&h.push(top.krpanotools.encodeParam("-xml="+p)),m_embeddedfiles.opt_encryptall&&h.push(top.krpanotools.encodeParam("-encemb"));var d=m_embeddedfiles.files,v=d.length,u;for(u=0;u<v;u++){var m=d[u];m.embed&&m.filepath!=p&&h.push(top.krpanotools.encodeParam(m.filepath+"|"+m.filepath_rel))}}a++,top.krpanotools.protectTool(h.join(" "),f)}if(t.m_html5){var g=[].concat(o);g.push(top.krpanotools.encodeParam("-o="+r)),a++,top.krpanotools.protectTool(g.join(" "),l)}ID("m_openoutputfolder").disabled=""}var e=top.nwrequire("path"),t=settings_from_dom();if(!t.m_flash&&!t.m_html5){top.krpanoui.alertDialog({title:"Generate Viewers",infotext:"No output selected!"});return}var s=t.m_flash&&t.m_html5?".swf,.js":t.m_flash?".swf":".js";top.gui_dialogs.saveAs(r,"",ui_last_output_folder,s)}var m_embeddedfiles=new swfembed,ui_last_output_folder_filename=null,ui_last_output_folder=null;top.gui_style_do_system_fixes(document),top.gui_block_external_dragging(document);var domainlist_listbox=top.gui_listbox(ID("m_domainlist"),[{name:"Domain",width:0,align:"left"}]);top.gui_contextmenu_assign_editmenu(ID("m_ed_url")),settings_to_dom(JSON.parse(localStorage.protect||"null")),update_flash_fields(),update_html5_fields(),update_expiredate_fields(),update_limitdomain_fields(),top.gui_get_global().shutdownEvents.push(function(e){e&&savesettings()}),top.reginfo.ready&&update_license_info()</script>